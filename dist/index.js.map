{"version":3,"file":"index.js","sources":["../src/is.js","../src/reactive.jsx","../src/handle.js","../src/par.js"],"sourcesContent":["// @flow\nexport function isFunction(o: any): boolean {\n    return typeof o === 'function';\n}\n\nexport function isObject(o: any): boolean {\n    return (\n        Boolean(o) &&\n        typeof o === 'object' &&\n        Object.prototype.toString.call(o) === '[object Object]'\n    );\n}\n\nexport function isNil(o: any): boolean {\n    return o === null || o === undefined;\n}\n\nexport function isSame(objA: any, objB: any): boolean {\n    if (objA === objB) {\n        return true;\n    }\n    if (!isObject(objA) || !isObject(objB)) {\n        return false;\n    }\n    const keysA = Object.keys(objA);\n    const keysB = Object.keys(objB);\n    const sameSize = keysA.length === keysB.length;\n    const sameValues = () => keysA.every(key => objA[key] === objB[key]);\n    return sameSize && sameValues();\n}\n","import React, { Component } from 'react';\nimport { BehaviorSubject, of, concat, combineLatest } from 'rxjs';\nimport { filter, distinctUntilChanged, scan } from 'rxjs/operators';\nimport { isObject, isSame } from './is';\n\nexport function reactive(propsMapper) {\n    return WrappedComponent =>\n        class ReactiveWrapper extends Component {\n            static displayName = `Reactive(${WrappedComponent.displayName ||\n                WrappedComponent.name})`;\n\n            constructor(props) {\n                super(props);\n                this.state = props;\n            }\n\n            componentDidMount() {\n                this.propsSubject = new BehaviorSubject(this.props);\n                const props$ = this.propsSubject.pipe(distinctUntilChanged(isSame));\n                const deltaProps$ = propsMapper(props$).pipe(\n                    filter(isObject),\n                    scan((acc, delta) => Object.assign(acc, delta), {}),\n                );\n                const newProps$ = combineLatest(\n                    props$,\n                    concat(of({}), deltaProps$),\n                    (props, delta) => Object.assign({}, props, delta),\n                );\n                this.subscription = newProps$.subscribe((newProps) => {\n                    this.setState(newProps);\n                });\n            }\n\n            componentDidUpdate() {\n                this.propsSubject.next(this.props);\n            }\n\n            componentWillUnmount() {\n                this.propsSubject.complete();\n                this.subscription.unsubscribe();\n            }\n\n            render() {\n                return <WrappedComponent {...this.state} />;\n            }\n        };\n}\n","import { Subject, of, concat } from 'rxjs';\nimport { filter, pluck, distinctUntilChanged, switchMap } from 'rxjs/operators';\nimport { isFunction, isObject } from './is';\n\nexport function handle(propName, ...handlerOperators) {\n    return props$ =>\n        props$.pipe(\n            pluck(propName),\n            distinctUntilChanged(),\n            switchMap((handler) => {\n                const eventsSubject = new Subject();\n                const wrappedHandler = (event) => {\n                    eventsSubject.next(event);\n                    if (isFunction(handler)) handler(event);\n                };\n                return concat(\n                    of({\n                        [propName]: wrappedHandler,\n                    }),\n                    eventsSubject.pipe(\n                        ...handlerOperators,\n                        filter(obj => !(obj instanceof Event)),\n                        filter(isObject),\n                    ),\n                );\n            }),\n        );\n}\n","import { merge } from 'rxjs';\n\nexport function par(...operators) {\n    return props$ => merge(...operators.map(op => op(props$)));\n}\n"],"names":["isFunction","o","isObject","Boolean","Object","prototype","toString","call","isNil","undefined","isSame","objA","objB","keysA","keys","keysB","sameSize","length","sameValues","every","key","reactive","propsMapper","props","state","componentDidMount","propsSubject","BehaviorSubject","props$","pipe","distinctUntilChanged","deltaProps$","filter","scan","acc","delta","assign","newProps$","combineLatest","concat","of","subscription","subscribe","newProps","setState","componentDidUpdate","next","componentWillUnmount","complete","unsubscribe","render","React","Component","displayName","WrappedComponent","name","handle","propName","handlerOperators","pluck","switchMap","handler","eventsSubject","Subject","wrappedHandler","event","obj","Event","par","operators","merge","map","op"],"mappings":"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"}